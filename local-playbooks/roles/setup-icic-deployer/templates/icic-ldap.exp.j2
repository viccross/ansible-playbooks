#!/usr/bin/expect -f
# =================================================================
# Licensed Materials - Property of IBM
#
# (c) Copyright IBM Corp. 2021 All Rights Reserved
#
# US Government Users Restricted Rights - Use, duplication or
# disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
# =================================================================
#
# icic-ldap.exp
#
# Interact with the icic-config program to configure ICIC to work with LDAP.
#
# This Expect script is based on a script generated by autoexpect
# Expect and autoexpect were both written by Don Libes, NIST.
#

set timeout -1
spawn icic-config identity repository -t ldap -g admins --ldap-url ldap://ldapsrv.ibmpoc.internal \
  --user-tree-dn ou=people,ou=ibmzvm,o=ibm --group-tree-dn ou=groups,ou=ibmzvm,o=ibm --anon \
  --user-filter None --user-objectclass inetOrgPerson --user-id-attr uid --user-name-attr uid --user-mail-attr None --user-desc-attr cn \
  --group-filter None --group-objectclass groupOfNames --group-id-attr cn --group-name-attr cn --group-member-attr member --group-desc-attr description \
  --query-scope one --tls-cacertdir /etc/pki/ca-trust/source/anchors/
match_max 10000
expect -exact "Do you want to proceed? \[y/n\]"
send -- "y\r"
expect -exact "z/OS LDAP with SDBM backend? \[n\]: "
send -- "n\r"
expect -exact "The LDAP server provides an 'enabled' attribute for users? \[n\]: "
send -- "n\r"
expect -exact "Emulate an 'enabled' attribute for users? \[y\]: "
send -- "n\r"
expect eof
